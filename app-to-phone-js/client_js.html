<!DOCTYPE html>
<html lang="en">

<head>
  <script src="./node_modules/@vonage/client-sdk/dist/vonageClientSDK.min.js"></script>
  <style>
    input, button {
      font-size: 1rem;
    }
    #hangup {
      display: none;
    }
  </style>
</head>

<body>
  <h1>Call Phone from App</h1>
  <label for="phone-number">Your Phone Number:</label>
  <input type="text" name="phone-number" value="" placeholder="i.e. 14155550100" id="phone-number" size="30">
  <button type="button" id="call">Call</button>
  <button type="button" id="hangup">Hang Up</button>
  <div id="status"></div>
  <script>

    let token = 'eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJpYXQiOjE2ODk4NjY0NDgsImp0aSI6IjAxN2I1MDEwLTI3MTEtMTFlZS05MGIyLTY5MmYzODUyODUxMSIsImFwcGxpY2F0aW9uX2lkIjoiY2E5OTYxZDQtMjg5Yi00ZjEwLTg2YTUtNjM1Nzk0OWJjMDE3Iiwic3ViIjoiQWxpY2UiLCJleHAiOjE2ODk4NjY0NzAzODUsImFjbCI6eyJwYXRocyI6eyIvKi91c2Vycy8qKiI6e30sIi8qL2NvbnZlcnNhdGlvbnMvKioiOnt9LCIvKi9zZXNzaW9ucy8qKiI6e30sIi8qL2RldmljZXMvKioiOnt9LCIvKi9pbWFnZS8qKiI6e30sIi8qL21lZGlhLyoqIjp7fSwiLyovYXBwbGljYXRpb25zLyoqIjp7fSwiLyovcHVzaC8qKiI6e30sIi8qL2tub2NraW5nLyoqIjp7fSwiLyovbGVncy8qKiI6e319fX0.U5vQ29d2id24kdBxDZE9gXjZwNfjNMGCb4vGVFuQe_16S8p5rHkilgfk5lil6d7FTTBgaaFePFjB2_2DgRJCcP_d3uoDPE87hEDHIx0SAHTIH0PxKCs5msQ4IekfxhMx5lsTkYQLV4T0RRaI46v4d8fO_gKC6FT3dEto0UKT6N9qkUbYtsURqSSKAwcuUCCh-PjvTnhXzVeCQB1bb0HoTr9kAsoXfidRbKtCtQIaw2zLKTkM9Vh31rMp8ZewrM6b-4bl0LXD18ADXNw4Xng5ifgs0929yQiqCy_m45rKpV3lXb9zt4BckXnkATkBthZ5r8RPBB58k3eiKI06kX26zg';
    const client = new vonageClientSDK.VonageClient();
    const config = new vonageClientSDK.ClientConfig(
      vonageClientSDK.ConfigRegion.US
    );
    client.setConfig(config);

    let callId = null;
    client.createSession(token).then((session) => {
      console.log({ session });

      const callButton = document.getElementById("call");
      const hangUpButton = document.getElementById("hangup");
      const statusElement = document.getElementById("status");

      callButton.addEventListener("click", event => {
        let destination = document.getElementById("phone-number").value;
        if (destination !== "") {
          client.serverCall({ to: destination }).then((_callId) => {
            callId = _callId;
          });
        } else {
          statusElement.innerText = 'Please enter your phone number.';
        }
      });

      hangUpButton.addEventListener("click", () => {
        client.hangup(callId).then(() => {
          callButton.style.display = "inline";
          hangupButton.style.display = "none";
        });
      });

      client.on('legStatusUpdate', (callId, legId, status) => {
        if (status === vonageClientSDK.LegStatus.ANSWERED) {
          callButton.style.display = "none";
          hangUpButton.style.display = "inline";
        }
        if (status === vonageClientSDK.LegStatus.COMPLETED) {
          callButton.style.display = "inline";
          hangUpButton.style.display = "none";
        }
      });

    }).catch((error) => {
      console.error(error);
    });
  </script>
</body>

</html>